Artifact submission for ESOP 2022 paper XXX
==========================================

This artifact includes Coq proofs for the results claimed about DDC in 
in [the submitted
paper](https://github.com/sweirich/graded-haskell/blob/main/ddc.pdf)
accepted to ESOP 2022. 

Getting Started Guide
=====================

Download instructions
---------------------

The artifact is available as a [VirtualBox](https://www.virtualbox.org/) available for download from 

XXXXX

After starting VirtualBox, the machine can be loaded via 

     File > Import Appliance...


Evaluation instructions
-----------------------

To use Coq to verify the claims, reviewers should import the provided virtual box
file.  Once the machine has been booted, a Terminal can be started
using the icon at the top-left of the screen.

Then, to compile the development, perform the following commands in a terminal window.
  
     cd ~ 
     cd graded-haskell/DDC/src
     make clean
     make coq

NOTE: On 2019 MacBook Pro, the entire development takes < 4 minutes to
compile. The file `Qualitative_inf.v` (generated from LNgen) is the largest component
of that time.

Note: reviwers can use the following credentials for administrator access on
the virtual machine.

     username: sweirich
     password: esop2022

The source code for the artifact is available from the public github repository:
https://github.com/sweirich/graded-haskell/tree/main/DDC


Step-by-Step Instructions
=========================

Complete claims made by the paper substantiated by this artifact
----------------------------------------------------------------

This artifact substantiates the results claimed in the paper as indicated by
the footnotes. All results are proved about the DDC calculus, presented in
Section 5.  The language DDC^Top (Section 4) is a specific instance of DDC,
so these results hold directly for that language as well.

* System specification

The full specification of the type system shown in Section 5 is in the file
`Qualitative_ott.v`. This file has been mechanically generated from the Ott
specification `Qualitative.ott` and then patched. For convenience, we
also provide the file `spec.pdf` that contains a typeset version of the
system, also generated from `Qualitative.ott`.

Note: the DDC in the artifact includes *both* weak and strong sigma-types
as primitive type forms. The file `strong_exists.v` shows that the rules 
for projection from strong sigmas are derivable from weak sigmas. Therefore, 
the paper only includes the specification of weak sigmas.

* Key results

The individual results can be found in the corresponding Coq files and theorem
statements as directed by the paper's footnotes. (All Coq files are in the
`src` subdirectory.)

Section 3

NOTE: the paper presents these lemmas about SDC, but our Coq proofs show that
they also hold for DDC. Reveiwers found this confusing, so in our revision of the
paper we will clarify.

     Lemma 5 (Typing implies grading)
     Lemma 6 (Equivalence) 
     Lemma 7 (Indistinguishability under substitution)
     Theorem 1 (Non-interference) 
      
Section 5

      Theorem 8 (Consistency)
      Lemma 8 (Canonical Element)
      Lemma 9 (Erasure Indistinguishability)
      Lemma 10 (Erasure simulation)
      Lemma 11 (Narrowing)
      Lemma 12 (Weakening)
      Lemma 13 (Restricted Upgrading) 
      Lemma 14 (Bounded by C)
      Lemma 15 (Subsumption)
      Lemma 16 (Substitution)
      Lemma 17 (Regularity)
      Lemma 18 (Preservation)
      Lemma 19 (Progress)
      
New material

The reviewers have requested more details about the decidability of type
checking for certain instances of DDC. In support of the new claims, we will
add the following theorem to the paper showing the equivalence of definitional
equality and the joins relation.  (The other direction of this lemma is
already used to show consistency.)

    Lemma Joins_DefEq : 
       forall S D A B, Joins S D A B -> DefEq S D A B.
      

* Parameters and Axioms made in Coq development

- Abstract properties of the lattice (grade_sig.v)
- Sorts, Axioms and Rules of the Pure Type System (sort_sig.v) as described at 
  the beginning of Section 5.
- Lemmas about substitution generated by LNgen tool (Qualitative_inf.v)
- Local closure properties of all relations (tactics.v)
- Properties about variable renaming (strong_exists.v)

Complete claims made by the paper NOT substantiated by this artifact
----------------------------------------------------------------

This artifact only includes results about the DDC language. Therefore, results
about SDC or about a translation between languages are not proved here.

Section 3

Lemmas 1-7, Theorem 1.  Properties of SDC that are similar to analogous results for DDC.
Theorems 2-4. Translation between DCC and SDC.

Section 4

Theorems 5-7. Translation between SDC and DDC^Top.

Additional artifact description
-------------------------------

See the [README.md](https://github.com/sweirich/graded-haskell) for the artifact site.



- sudo apt install git-all
- sudo add-apt-repository ppa:avsm/ppa
- sudo apt update
- sudo apt install make
- sudo apt install gcc
- sudo apt install opam
- opam init
- opam switch create 4.09.1
- eval $(opam env --switch=4.01.1)
- opam repo add coq-released https://coq.inria.fr/opam/released
- opam pin coq 8.10.2
- opam install ott
- opam pin add coq-metalib https://github.com/plclub/metalib.git
- git clone https://github.com/sweirich/graded-haskell.git
